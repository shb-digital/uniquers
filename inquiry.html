<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="footer-style.css">  
  <link rel="apple-touch-icon" href="favicon.png"> <!-- iOS 홈화면용 -->
  <link rel="shortcut icon" href="favicon.png" type="image/png">
  <!-- Pretendard Variable CDN -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable-dynamic-subset.css">

  <title>아이디어 조회</title>
  <style>
    :root{
      --text:#0b1220; --muted:#666; --primary:#0046ff; --line:#e6e9ef; --ring:rgba(0,70,255,.18);
      --header-h:64px; --ink:#0b1220; --muted2:#6b7280; --line2:#e5e7eb; --bg:#ffffffF2;
      --container:1200px;
    }
    body {
        margin: 0;
        font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, Roboto, "Helvetica Neue", Arial, "Noto Sans KR", sans-serif;
        font-size: 15px;
        line-height: 1.65;
        color: var(--text);
    }
    body.loading{overflow:hidden}
    main{padding:32px 0}
    [doz_type="inside"]{max-width:var(--container); margin:0 auto; padding:0 24px;}
    @media (max-width:480px){[doz_type="inside"]{padding:0 16px}}

    .idea-lookup-wrap{background:#fff;padding:28px;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,.1);}
    .il-grid{display:grid;grid-template-columns:1fr 1fr auto;gap:12px}
    @media (max-width:900px){.il-grid{grid-template-columns:1fr}}
    .il-field{display:flex;flex-direction:column;gap:8px}
    .il-label{font-weight:800}
    .il-input{appearance:none;border:1.5px solid var(--line);border-radius:12px;padding:12px 14px;font:inherit}
    .il-input:focus{outline:none;border-color:#9fb0ce;box-shadow:0 0 0 6px var(--ring)}
    .il-btn{border:1.5px solid var(--line);background:var(--primary);color:#fff;border-radius:12px;padding:12px 16px;font-weight:800;cursor:pointer}
    .il-status{margin-top:10px;color:var(--muted)}

    /* Overlay & Modal */
    .overlay{position:fixed;inset:0;background:rgba(8,14,30,.45);display:none;backdrop-filter:blur(6px)}
    .modal{position:fixed;inset:0;display:none;place-items:center;padding:20px}
    .dialog{width:min(520px,92%);background:#fff;border:1px solid #e8edf5;border-radius:24px;box-shadow:0 24px 60px rgba(0,0,0,.18);overflow:hidden}
    #resultModal .bd{padding:28px 28px 18px}
    #resultModal h3{margin:0 0 6px;font-size:20px;line-height:1.35;letter-spacing:-.02em;color:#0b1220;text-align:center;font-weight:800}
    #resultModal .sub{margin:0 0 14px;text-align:center;color:#6b7684}
    #resultModal .review-box{background:#f7f9fd;border:1px solid #e6ebf4;border-radius:16px;padding:6px 0;margin-top:8px}
    #resultModal .cf-row{display:grid;grid-template-columns:120px 1fr;gap:12px;padding:12px 16px;align-items:center}
    #resultModal .cf-row + .cf-row{border-top:1px dashed #e2e8f3}
    #resultModal .cf-label{font-weight:800;color:#111827}
    #resultModal .cf-value{color:#334155;word-break:break-word}
    #resultModal .ft{display:flex;gap:10px;justify-content:flex-end;padding:0 24px 22px}
    #resultModal .ft .il-btn{border-radius:12px;padding:12px 18px}

    /* Busy overlay */
    .busy{position:fixed;inset:0;display:none;place-items:center;z-index:2147483647;background:rgba(8,14,30,.55);backdrop-filter:blur(8px)}
    .busy .panel{background:#0b1220;color:#fff;border-radius:16px;padding:18px 20px;display:flex;align-items:center;gap:12px;min-width:240px;justify-content:center}
    .spinner{width:22px;height:22px;border-radius:50%;border:3px solid rgba(255,255,255,.25);border-top-color:#fff;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    .il-btn.is-loading{opacity:.9;position:relative;pointer-events:none}
    .il-btn.is-loading::after{
      content:"";position:absolute;inset:0;
      background:linear-gradient(120deg,rgba(255,255,255,0) 0%,rgba(255,255,255,.35) 45%,rgba(255,255,255,0) 90%);
      transform:translateX(-120%);animation:shimmer 1.1s linear infinite
    }
    @keyframes shimmer{0%{transform:translateX(-120%)}100%{transform:translateX(120%)}}

    /* ===== Header ===== */
    .site-header,*{box-sizing:border-box}
    .site-header{
      position:sticky; top:0; z-index:1000;
      backdrop-filter:saturate(140%) blur(8px);
      -webkit-backdrop-filter:saturate(140%) blur(8px);
      background:var(--bg);
      border-bottom:1px solid rgba(17,24,39,.06);
    }
    .site-header .bar{
      max-width:var(--container); margin:0 auto; height:var(--header-h);
      padding:0 20px; display:flex; align-items:center; gap:16px;
    }
    .brand{font-weight:900; text-decoration:none; color:var(--ink);}
    .brand .title{font-size:18px; color:#676767;}
    nav{margin-left:auto}
    .nav-list{display:flex; gap:6px; list-style:none; margin:0; padding:0;}
    .nav-list a{padding:10px 12px;border-radius:10px;text-decoration:none;color:var(--ink);font-weight:700}
    .nav-list a:hover{background:#f3f5f9}
    .nav-list a.active{color:var(--primary);background:#eef3ff;border:1px solid #dbe7ff}
    .hamb{display:none;margin-left:auto}
    .hamb button{width:40px;height:40px;border-radius:10px;border:1px solid var(--line2);background:#fff;display:grid;place-items:center;cursor:pointer}
    .drawer{display:none;position:fixed;inset:var(--header-h) 0 auto 0;z-index:999;background:#fff;border-top:1px solid var(--line2);box-shadow:0 12px 30px rgba(0,0,0,.08);padding:10px 16px;}
    .drawer a{display:block;padding:12px 10px;border-radius:10px;color:var(--ink);text-decoration:none;font-weight:700}
    .drawer a:hover{background:#f3f5f9}
    .drawer a.active{color:var(--primary);background:#eef3ff;border:1px solid #dbe7ff}
    @media(max-width:960px){nav{display:none}.hamb{display:block}}
    .drawer { z-index: 1001; }
    .site-header { z-index: 1000; }

        /* ===== Overlay & Modal (결과 팝업) ===== */
    .overlay{position:fixed;inset:0;background:rgba(8,14,30,.45);display:none;backdrop-filter:blur(6px)}
    .modal{position:fixed;inset:0;display:none;place-items:center;padding:20px}
    .dialog{width:min(520px,92%);background:#fff;border:1px solid #e8edf5;border-radius:24px;box-shadow:0 24px 60px rgba(12,18,31,.18);overflow:hidden}

    #resultModal .bd{padding:28px 28px 18px}
    #resultModal h3{margin:0 0 6px;font-size:20px;line-height:1.35;letter-spacing:-.02em;color:#0b1220;text-align:center;font-weight:800}
    #resultModal .sub{margin:0 0 14px;text-align:center;color:#6b7684}
    #resultModal .review-box{background:#f7f9fd;border:1px solid #e6ebf4;border-radius:16px;padding:6px 0;margin-top:8px}
    #resultModal .cf-row{display:grid;grid-template-columns:120px 1fr;gap:12px;padding:12px 16px;align-items:center}
    #resultModal .cf-row + .cf-row{border-top:1px dashed #e2e8f3}
    #resultModal .cf-label{font-weight:800;color:#111827}
    #resultModal .cf-value{color:#334155;word-break:break-word}
    #resultModal .bd .il-note{margin-top:12px;text-align:center}
    #resultModal .ft{display:flex;gap:10px;justify-content:flex-end;padding:0 24px 22px}
    #resultModal .ft .il-btn{border-radius:12px;padding:12px 18px}
    #resultModal #rmOk{min-width:140px}

    /* ===== Screen-Lock Busy Overlay (조회 중) ===== */
    .busy{position:fixed;inset:0;display:none;place-items:center;z-index:2147483647;background:rgba(8,14,30,.55);backdrop-filter:blur(8px)}
    .busy .panel{
      background:#0b1220;border:1px solid rgba(255,255,255,.08);color:#fff;
      border-radius:16px;padding:18px 20px;box-shadow:0 24px 60px rgba(0,0,0,.35);
      display:flex;align-items:center;gap:12px;min-width:240px;justify-content:center
    }
    .spinner{
      width:22px;height:22px;border-radius:50%;
      border:3px solid rgba(255,255,255,.25);border-top-color:#fff;
      animation:spin .8s linear infinite;flex:none
    }
    @keyframes spin{to{transform:rotate(360deg)}}
    .busy .txt{font-weight:800;letter-spacing:.02em}

    /* 버튼 로딩상태 시각 강화(선택) */
    .il-btn.is-loading{opacity:.9;position:relative;pointer-events:none}
    .il-btn.is-loading::after{
      content:"";position:absolute;inset:0;
      background:linear-gradient(120deg,rgba(255,255,255,0) 0%,rgba(255,255,255,.35) 45%,rgba(255,255,255,0) 90%);
      transform:translateX(-120%);animation:shimmer 1.1s linear infinite
    }
    @keyframes shimmer{0%{transform:translateX(-120%)}100%{transform:translateX(120%)}}
  </style>
  
</head>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const btn = document.getElementById('menuBtn');
    const drawer = document.getElementById('mobileMenu');
    if (!btn || !drawer) return;

    function open() {
      drawer.hidden = false;
      drawer.style.display = 'block';
      btn.setAttribute('aria-expanded', 'true');
      btn.setAttribute('aria-label', '메뉴 닫기');
      // 바깥 클릭/ESC로 닫기
      document.addEventListener('click', outside, { capture: true });
      document.addEventListener('keydown', esc);
    }

    function close() {
      drawer.style.display = 'none';
      drawer.hidden = true;
      btn.setAttribute('aria-expanded', 'false');
      btn.setAttribute('aria-label', '메뉴 열기');
      document.removeEventListener('click', outside, { capture: true });
      document.removeEventListener('keydown', esc);
    }

    function outside(e) {
      if (!drawer.contains(e.target) && !btn.contains(e.target)) close();
    }
    function esc(e) {
      if (e.key === 'Escape') close();
    }

    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const expanded = btn.getAttribute('aria-expanded') === 'true';
      expanded ? close() : open();
    });
  });
</script>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="bar">
      <a class="brand" href="/uniquers/"><span class="title">2025 UNIQUERS</span></a>
      <nav><ul class="nav-list">
        <li><a href="/uniquers/">홈</a></li>
        <li><a href="/uniquers/submit.html">아이디어 접수</a></li>
        <li><a href="/uniquers/inquiry.html">아이디어 조회</a></li>
      </ul></nav>
      <div class="hamb"><button id="menuBtn" aria-controls="mobileMenu"><svg viewBox="0 0 24 24"><path stroke="currentColor" stroke-width="2" stroke-linecap="round" d="M4 7h16M4 12h16M4 17h16"/></svg></button></div>
    </div>
    <nav class="drawer" id="mobileMenu" hidden>
      <a href="/uniquers/">홈</a>
      <a href="/uniquers/submit.html">아이디어 접수</a>
      <a href="/uniquers/inquiry.html">아이디어 조회</a>
    </nav>
  </header>

  <!-- Content -->
  <main>
    <div doz_type="inside">
      <h2 style="text-align:center;font-size:28px;color:#0046ff;font-weight:bold;margin-bottom:20px;">아이디어 조회</h2>
      <p style="text-align:center;color:#666;margin-bottom:30px;">접수번호와 팀장 행번을 입력해주세요.<br>접수번호를 잊어버리셨으면 uniquers@shinhan.com으로 문의부탁드립니다.🐿️</p>
      <div class="idea-lookup-wrap">
        <div class="il-grid">
          <div class="il-field"><label class="il-label">접수번호 (6자리)</label><input class="il-input" id="ilCode" placeholder="예: 104293"></div>
          <div class="il-field"><label class="il-label">팀장 행번</label><input class="il-input" id="ilLeadEmp" placeholder="예: 10004000"></div>
          <div class="il-field" style="align-self:end"><button id="ilLookupBtn" class="il-btn">조회</button></div>
        </div>
        <div id="ilStatus" class="il-status"></div>
      </div>
    </div>
  </main>
    <!-- 숨김 iframe: GAS가 이 안에서 다시 iframe 래핑하므로 allow-same-origin 필요 -->
  <iframe id="inq_iframe" name="inq_iframe" style="display:none" sandbox="allow-scripts allow-forms allow-same-origin" referrerpolicy="no-referrer"></iframe>

  <!-- 결과 모달 -->
  <div class="overlay" id="overlay"></div>
  <div class="modal" id="resultModal">
    <div class="dialog" role="dialog" aria-modal="true" aria-labelledby="rmTitle">
      <div class="bd">
        <h3 id="rmTitle">조회 결과</h3>
        <p class="sub" id="rmSub">입력하신 정보와 일치하는 접수 내역입니다.</p>
        <div class="review-box" id="rvBox">
          <div class="cf-row"><div class="cf-label">주제 분류</div><div id="rvCat" class="cf-value">-</div></div>
          <div class="cf-row"><div class="cf-label">팀장 행번</div><div id="rvEmp" class="cf-value">-</div></div>
          <div class="cf-row"><div class="cf-label">주제</div><div id="rvTitle" class="cf-value">-</div></div>
          <div class="cf-row"><div class="cf-label">제출일시</div><div id="rvTime" class="cf-value">-</div></div>
          <div class="cf-row"><div class="cf-label">접수번호</div><div id="rvCode" class="cf-value">-</div></div>
        </div>
        <p class="il-note">문의사항이 있으시면 메일부탁드립니다.</p>
      </div>
      <div class="ft">
        <button class="il-btn" id="rmOk">닫기</button>
      </div>
    </div>
  </div>

  <!-- 화면 잠금 Busy Overlay -->
  <div class="busy" id="busy" aria-hidden="true">
    <div class="panel" role="status" aria-live="polite">
      <div class="spinner" aria-hidden="true"></div>
      <div class="txt">조회 중…</div>
    </div>
  </div>

  <script>
    // ======= 조회용 GAS 웹앱 URL (배포 URL로 교체) =======
    const GAS_ENDPOINT = 'https://script.google.com/macros/s/AKfycbwrDHWQNFXwLwvz2xC7um2woKZuHizy8vBsfxx2XihCh1QGnGIXaMpVGCSMqxM7SxC5/exec';

    const statusEl = document.getElementById('ilStatus');
    const overlay  = document.getElementById('overlay');
    const modal    = document.getElementById('resultModal');
    const busy     = document.getElementById('busy');
    const codeEl   = document.getElementById('ilCode');
    const empEl    = document.getElementById('ilLeadEmp');
    const lookupBtn= document.getElementById('ilLookupBtn');

    // 팝업 열고/닫기
    function openResultModal(){ overlay.style.display='block'; modal.style.display='grid'; }
    function closeResultModal(){ overlay.style.display='none'; modal.style.display='none'; }
    document.getElementById('rmOk').onclick = closeResultModal;
    overlay.onclick = closeResultModal;
    window.addEventListener('keydown', e => { if (e.key === 'Escape') closeResultModal(); });

    // Busy Overlay 제어
    let busyTimer = null;
    let prevBtnText = '조회';
    function setLoading(on){
      if (on){
        document.body.classList.add('loading');
        busy.style.display = 'grid';
        if (lookupBtn){
          prevBtnText = lookupBtn.textContent;
          lookupBtn.classList.add('is-loading');
          lookupBtn.textContent = '조회 중…';
          lookupBtn.disabled = true;
        }
        if (codeEl) codeEl.disabled = true;
        if (empEl)  empEl.disabled  = true;

        // 20초 타임아웃(응답 지연/오류 대비)
        clearTimeout(busyTimer);
        busyTimer = setTimeout(()=>{
          setLoading(false);
          statusEl.textContent = '응답이 지연됩니다. 잠시 후 다시 시도해 주세요.';
        }, 20000);
      } else {
        document.body.classList.remove('loading');
        busy.style.display = 'none';
        if (lookupBtn){
          lookupBtn.classList.remove('is-loading');
          lookupBtn.textContent = prevBtnText || '조회';
          lookupBtn.disabled = false;
        }
        if (codeEl) codeEl.disabled = false;
        if (empEl)  empEl.disabled  = false;
        clearTimeout(busyTimer);
      }
    }

    // 허용 오리진
    function isAllowedOrigin(origin) {
      if (!origin) return false;
      if (origin === 'https://script.google.com') return true;
      if (origin.endsWith('.googleusercontent.com')) return true;
      return false;
    }

    // GAS → postMessage 수신
    window.addEventListener('message',(ev)=>{
      if (!isAllowedOrigin(ev.origin)) return;

      const data = ev.data || {};
      if (typeof data !== 'object') return;

      // 로딩 해제
      setLoading(false);
      statusEl.textContent = '';

      const sub = document.getElementById('rmSub');
      const box = document.getElementById('rvBox');

      if (!data.ok){
        sub.textContent = '일치하는 내역이 없습니다.';
        box.style.display = 'none';
        openResultModal();
        return;
      }

      box.style.display = '';
      const r = data.record || {};
      document.getElementById('rvCat').textContent   = r.category    || '';
      document.getElementById('rvEmp').textContent   = r.leadEmp     || '';
      document.getElementById('rvTitle').textContent = r.title       || '';
      document.getElementById('rvTime').textContent  = r.submittedAt || '';
      document.getElementById('rvCode').textContent  = r.code        || '';

      sub.textContent = '입력하신 정보와 일치하는 접수 내역입니다.';
      openResultModal();
    });

    // 조회 버튼
    if (lookupBtn) {
      lookupBtn.addEventListener('click', ()=>{
        const code    = codeEl?.value.trim() || '';
        const leadEmp = empEl?.value.trim()  || '';
        if(!/^\d{6}$/.test(code)){ statusEl.textContent='접수번호 6자리를 입력하세요.'; return; }
        if(!/^\d+$/.test(leadEmp)){ statusEl.textContent='팀장 행번을 숫자로 입력하세요.'; return; }

        statusEl.textContent='조회 중…';
        setLoading(true);

        const url = `${GAS_ENDPOINT}?action=lookup&code=${encodeURIComponent(code)}&leadEmp=${encodeURIComponent(leadEmp)}&transport=iframe&t=${Date.now()}`;
        const ifr = document.getElementById('inq_iframe');
        if (ifr) ifr.src = url;
      });
    }
  </script>
  <!-- ===== Footer ===== -->
    <footer class="site-footer">
    <div class="container">
        <p class="brand">2025 UNIQUERS</p>
        <p class="contact">문의 : uniquers@shinhan.com</p>
    </div>
    </footer>

  <!-- 모달, busy 오버레이 (생략 가능: 기존 코드 동일) -->
</body>
</html>
